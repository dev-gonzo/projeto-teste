server {
  listen 80;
  server_name localhost;

  include /etc/nginx/mime.types;

  location = / {
    return 200 'OK';
    add_header Content-Type text/plain;
  }

  # Bloco principal para a aplicação. Lida com o roteamento da SPA.
  location /avs-portaldemidias/ {
    # 'alias' é a chave da solução. Ele diz ao Nginx: "para requisições que começam
    # com /avs-portaldemidias/, procure os arquivos correspondentes dentro de
    # /usr/share/nginx/html/". A parte /avs-portaldemidias/ é removida da busca.
    alias /usr/share/nginx/html/;

    # Se um arquivo/diretório não for encontrado, sirva o index.html da SPA.
    # O caminho de fallback deve incluir o subdiretório.
    try_files $uri $uri/ /avs-portaldemidias/index.html;

    # Headers para o index.html (sem cache)
    add_header Pragma "no-cache";
    add_header Cache-Control "no-store, no-cache, must-revalidate";
    add_header Cross-Origin-Opener-Policy "same-origin";
    add_header Cross-Origin-Embedder-Policy "require-corp";
  }

  location = /avs-portaldemidia/healthz {
    return 200 'OK';
    add_header Content-Type text/plain;
  }

    location = /avs-portaldemidias/healthz {
    return 200 'OK';
    add_header Content-Type text/plain;
  }
  # Bloco específico para assets estáticos (JS, CSS, fontes, imagens).
  # A regex é ancorada (^) no início do caminho para ser mais eficiente.
  location ~ ^/avs-portaldemidias/(.+\.(?:js|css|woff2?|ttf|eot|otf|svg|ico|jpg|jpeg|png|gif|webp))$ {
    # Usamos alias aqui também para mapear para o arquivo correto.
    # $1 captura apenas o nome do arquivo (ex: chunk-NMGI7OHJ.js)
    alias /usr/share/nginx/html/$1;

    # Configurações de cache de longa duração para os assets
    access_log off;
    expires 1y;
    add_header Cache-Control "public, immutable";
    add_header Cross-Origin-Resource-Policy same-origin;
  }

  gzip on;
  gzip_static on;
  gzip_types text/plain text/css application/json application/javascript text/javascript application/x-javascript;
}